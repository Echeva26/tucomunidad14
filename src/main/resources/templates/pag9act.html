<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8"/>
    <title>Crea una nueva comunidad de vecinos</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="../static/css/ejemplo.css"/>
</head>


<script>
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('crearComunidadForm').addEventListener('submit', function(e) {
        e.preventDefault(); // Evita el envío tradicional del formulario
    
        // Recolecta los valores ingresados por el usuario
        const nombreComunidad = document.getElementById('nombre_comunidad').value;
        const codigoPostal = document.getElementById('codigo_postal').value;
    
        // Prepara los datos para ser enviados
        const data = {
          nombre: nombreComunidad,
          codpostal: codigoPostal
        };
    
        // Realiza la solicitud POST
        fetch('/crearcomunidad', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data) // Convierte los datos del formulario en una cadena JSON
        })
        .then(response => {
          if (!response.ok) {
          throw new Error('La solicitud ha fallado');
          }
          const contentType = response.headers.get('content-type');
          if (!contentType || !contentType.includes('application/json')) {
          throw new TypeError("Oops, we haven't got JSON!");
          }
          return response.json();
          })
        .then(data => {
          console.log(data);
          alert('Comunidad creada con éxito');
          // Aquí puedes redirigir al usuario o mostrar un mensaje de éxito
          <a href="pag9act.html">Crear</a>
        })
        .catch((error) => {
          console.error('Error:', error);
        });
      });
    });

    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('crearComunidadForm').addEventListener('submit', function(e) {
            e.preventDefault(); // Evita el envío tradicional del formulario
        
            // Recolecta los valores ingresados por el usuario
            const nombreComunidad = document.getElementById('nombre_comunidad').value;
            const codigoPostal = document.getElementById('codigo_postal').value;
            const zonasComunesSeleccionadas = Array.from(document.getElementById('zonas_comunes').selectedOptions).map(option => option.value);
            
            // Asignar el ID de la comunidad creada a estas variables de manera adecuada
            const idComunidad = 1;
            
            // Supongamos que quieres enviar cada área común seleccionada como una petición separada
            zonasComunesSeleccionadas.forEach(zonaComun => {
                const areaData = {
                    nombre: zonaComun, // O cualquier otra lógica para definir el nombre basado en el valor seleccionado
                    tipodearea: zonaComun, // Asumiendo que el valor seleccionado puede ser usado como tipo de área
                    idComunidad: idComunidad // Usar el ID de la comunidad correcto
                };
                
                fetch('/creararea', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(areaData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('La solicitud ha fallado');
                    }
                    return response.json(); // O manejar de otra manera la respuesta satisfactoria
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            });
            
            // Aquí el resto del código para crear la comunidad...
        });
    });
</script>
    
    

<body>
<!-- CABECERA -->
<div class="cabecera">
    <span class="crea-una-comunidad">
      Crea una comunidad de vecinos
    </span>
    <div class="container">
        <div class="tu-comunidad">
            TuComunidad
        </div>
        <p class="home">
            <span class="home-sub-30">Home</span><span></span>
        </p>
        <div class="log-out">
        <span class="our-works">
          Log Out
        </span>
        </div>
        <div class="usuario">
            Vecino
        </div>
    </div>
</div>

<div class="pagina">
    <div class="container-6">

        <div class="title-section">
            <h1 class="bold-text">Crea una nueva comunidad de vecinos</h1>
        </div>

        <div class="form-container">
            <p class="bold-text"><span class="form-text">Para crear una nueva comunidad rellene los siguientes
                    datos:</span></p>
            <!-- FORMULARIO -->
            <form id="crearComunidadForm">
                <div class="form-field">
                  <label for="nombre_comunidad" class="form-label">Nombre de la comunidad*:</label>
                  <input type="text" id="nombre_comunidad" name="nombre" class="form-input" placeholder="Escriba el nombre"/>
                </div>
                <div class="form-field">
                  <label for="codigo_postal" class="form-label">Código postal*:</label>
                  <input type="text" id="codigo_postal" name="codpostal" class="form-input" placeholder="Escriba el código postal"/>
                </div>
                <div class="form-field">
                  <label for="zonas_comunes" class="form-label">Zonas comunes:</label>
                  <select id="zonas_comunes" name="zonasComunes" class="form-input" multiple>
                    <option value="pistas_padel">Pistas de pádel</option>
                    <option value="local">Local</option>
                    <option value="gimnasio">Gimnasio</option>
                  </select>
                </div>
                <button class="join-button" type="submit">Crear</button>
                
              </form>
              
            <!-- FIN DEL FORMULARIO -->
        </div>

    </div>
</div>

<!-- PIE DE PAGINA -->
<div class="pie-de-pagina">
    <div class="container-5">
        <div class="image-2">
        </div>
        <div class="container-4">
            <img class="icon-1" src="../static/vectors/intagram.svg"/>
            <img class="icon-2" src="../static/vectors/facebook.svg"/>
            <img class="icon-3" src="../static/vectors/twitter.svg"/>
        </div>
        <div class="idioma">
        <span class="language">
          Idioma
        </span>
            <img class="icon-color" src="../static/vectors/flecha.svg"/>
        </div>
    </div>
    <div class="description">
        Facilitamos la convivencia en tu comunidad
    </div>
    <div class="line">
    </div>
    <span class="tucom">
      ©TuComunidad 2024
    </span>
</div>

</body>
</html>