<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8"/>
    <title>Crea una nueva comunidad de vecinos</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="../static/css/ejemplo.css"/>
</head>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('crearComunidadForm').addEventListener('submit', function(e) {
      e.preventDefault(); // Evita el envío tradicional del formulario
  
      // Recolecta los valores ingresados por el usuario
      const nombreComunidad = document.getElementById('nombre_comunidad').value;
      const codigoPostal = document.getElementById('codigo_postal').value;
      const zonasComunesSeleccionadas = Array.from(document.getElementById('zonas_comunes').selectedOptions).map(option => option.value);
  
      // Prepara los datos para ser enviados
      const data = {
        nombre: nombreComunidad,
        codpostal: codigoPostal, // Asume que el servidor puede manejar las zonas comunes como una cadena separada por comas
      };
  
      // Realiza la solicitud POST a crearcomunidad
      fetch('/crearcomunidad', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data) // Convierte los datos del formulario en una cadena JSON
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('La solicitud ha fallado con estado: ' + response.status);
        }
        return response.json(); // Asegura que la respuesta sea en formato JSON
      })
      .then(data => {
        console.log(data);
        alert('Comunidad creada con éxito.');
        <a href="pag7act2.html"></a>

      })
      .catch((error) => {
        console.error('Error:', error);
        
      });
    });
  });

  document.getElementById('crearComunidadForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const zonasComunesSeleccionadas = Array.from(document.getElementById('zonas_comunes').selectedOptions).map(option => option.value);

  // Ejemplo: enviar cada área común seleccionada como una solicitud separada
  zonasComunesSeleccionadas.forEach(zonaComun => {
    const areaData = {
        nombre: zonaComun, // Este será el valor seleccionado; adapta según tu modelo de datos
        tipodearea: zonaComun,
        idcomunidad:1 // Esto también, ajusta según necesidad
    };

    fetch('/creararea', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(areaData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('La solicitud ha fallado');
        }
        return response.json();
    })
    .then(data => {
        console.log(data);
        
    })
    .catch((error) => {
        console.error('Error:', error);
    });
  });
});
  </script>
     
    

<body>
<!-- CABECERA -->
<div class="cabecera">
    <span class="crea-una-comunidad">
      Crea una comunidad de vecinos
    </span>
    <div class="container">
        <div class="tu-comunidad">
            TuComunidad
        </div>
        <p class="home">
          <a href="/comunidad" style="text-decoration: none;">
            <span class="home-sub-30">Home</span>
            <span></span>
        </a>        
      </p>
        <div class="log-out">
        <span class="our-works">
          <a href="/" style="text-decoration: none;">Log out</a>
        </span>
        </div>
        <div class="usuario">
            Vecino
        </div>
    </div>
</div>

<div class="pagina">
    <div class="container-6">

        <div class="title-section">
          
        </div>

        <div class="form-container">
           
          
        

            <!-- FORMULARIO -->
            
            <form id="crearComunidadForm">
              <h2>Para crear una nueva comunidad, rellene los siguientes datos:</h2>
              <div style="display: inline-block; width: 100%;">
                  <div class="form-field" style="width: 30%; display: inline-block;">
                      <label for="nombre_comunidad" class="form-label">Nombre de la comunidad*:</label>
                      <input type="text" id="nombre_comunidad" name="nombre" class="form-input" placeholder="Escriba el nombre"/>
                  </div>
                  <div class="form-field" style="width: 30%; display: inline-block;">
                      <label for="codigo_postal" class="form-label">Código postal*:</label>
                      <input type="text" id="codigo_postal" name="codpostal" class="form-input" placeholder="Escriba el código postal"/>
                  </div>
                  <div class="form-field" style="width: 30%; display: inline-block;">
                      <label for="zonas_comunes" class="form-label">Zonas comunes:</label>
                      <select id="zonas_comunes" name="zonasComunes" class="form-input" multiple style="width: 100%;">
                          <option value="pistas_padel">Pistas de pádel</option>
                          <option value="local">Local</option>
                          <option value="gimnasio">Gimnasio</option>
                      </select>
                  </div>
              </div>
              <button class="join-button" type="submit" style="display: block; margin-top: 10px;"><a href="pag7act2.html">Crear</a></button>
          </form>
            <!-- FIN DEL FORMULARIO -->
        </div>

    </div>
</div>

<!-- PIE DE PAGINA -->
<div class="pie-de-pagina">
    <div class="container-5">
        <div class="image-2">
        </div>
        <div class="container-4">
            <img class="icon-1" src="../static/vectors/intagram.svg"/>
            <img class="icon-2" src="../static/vectors/facebook.svg"/>
            <img class="icon-3" src="../static/vectors/twitter.svg"/>
        </div>
        <div class="idioma">
        <span class="language">
          Idioma
        </span>
            <img class="icon-color" src="../static/vectors/flecha.svg"/>
        </div>
    </div>
    <div class="description">
        Facilitamos la convivencia en tu comunidad
    </div>
    <div class="line">
    </div>
    <span class="tucom">
      ©TuComunidad 2024
    </span>
</div>

</body>
</html>